const fs = require('fs');
const moment = require('moment-timezone');

const jadwal = {
    0: { open: '07:00', close: '22:00', dayName: 'Minggu ðŸŒž' },
    1: { open: '14:00', close: '21:00', dayName: 'Senin ðŸŒ™' },
    2: { open: '14:00', close: '21:00', dayName: 'Selasa ðŸŒ™' },
    3: { open: '14:00', close: '21:00', dayName: 'Rabu ðŸŒ™' },
    4: { open: '14:00', close: '21:00', dayName: 'Kamis ðŸŒ™' },
    5: { open: '14:00', close: '21:00', dayName: 'Jumat ðŸŒ™' },
    6: { open: '07:00', close: '22:00', dayName: 'Sabtu ðŸŒž' }
};

module.exports = async (client) => {
    const now = moment().tz('Asia/Jakarta');
    const day = now.day();
    const currentTime = now.format('HH:mm');
    const { open, close, dayName } = jadwal[day];

    if (currentTime >= open && currentTime <= close) return;

    const statusToko = `ðŸ”´ TUTUP | Buka besok ${dayName} ${open}-${close} WIB âŽ`;
    const bannerImage = 'https://img12.pixhost.to/images/1297/581857224_yilzishop.jpg';

    const messageText = `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        ðŸ¤– *BOTSHOP V5* ðŸ¤–
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“¢ *Status Layanan:*
${statusToko}

ðŸ•’ *Jadwal Operasional:*
â€¢ Weekdays: 14.00 - 21.00 WIB
â€¢ Weekend : 07.00 - 22.00 WIB

âŒ Saat ini *toko sedang tutup*.
â³ Silakan kembali saat jam operasional.

ðŸ“¦ Pesanan & layanan akan otomatis diproses saat toko buka kembali.

Terima kasih telah menggunakan *BOTSHOP V5* â€” solusi instan untuk kebutuhan bot dan layanan digital Anda!
`;

    const filePath = './library/database/json/respon.json';
    if (!fs.existsSync(filePath)) return;

    const data = JSON.parse(fs.readFileSync(filePath));
    const nowTime = Date.now();
    const cooldown = 6 * 60 * 60 * 1000;

    for (const number in data) {
        const lastSent = data[number]?.time || 0;
        if (nowTime - lastSent < cooldown) continue;

        try {
            await client.sendFile(number, bannerImage, 'botshop.jpg', messageText);
            data[number].time = nowTime;
            console.log(`âœ… Pesan terkirim ke ${number}`);
        } catch (err) {
            console.log(`âŒ Gagal kirim ke ${number}:`, err.message);
        }
    }

    fs.writeFileSync(filePath, JSON.stringify(data, null, 2));
};